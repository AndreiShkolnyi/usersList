{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from\"axios\";import{toast}from\"react-toastify\";import configFile from\"../config.json\";import authService from\"./auth.service\";import localStorageService from\"./localStorage.service\";var http=axios.create({baseURL:configFile.apiEndpoint});http.interceptors.request.use(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(config){var expiresDate,refreshToken,isExpired,containSlash,data,accessToken,_data,_accessToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:expiresDate=localStorageService.getTokenExpiresDate();refreshToken=localStorageService.getRefreshToken();isExpired=refreshToken&&expiresDate<Date.now();if(!configFile.isFireBase){_context.next=15;break;}containSlash=/\\/$/gi.test(config.url);config.url=(containSlash?config.url.slice(0,-1):config.url)+\".json\";if(!isExpired){_context.next=11;break;}_context.next=9;return authService.refresh();case 9:data=_context.sent;localStorageService.setTokens({refreshToken:data.refresh_token,idToken:data.id_token,expiresIn:data.expires_in,localId:data.user_id});case 11:accessToken=localStorageService.getAccessToken();if(accessToken){config.params=_objectSpread(_objectSpread({},config.params),{},{auth:accessToken});}_context.next=22;break;case 15:if(!isExpired){_context.next=20;break;}_context.next=18;return authService.refresh();case 18:_data=_context.sent;localStorageService.setTokens(_data);case 20:_accessToken=localStorageService.getAccessToken();if(_accessToken){config.headers=_objectSpread(_objectSpread({},config.headers),{},{Authorization:\"Bearer \".concat(_accessToken)});}case 22:return _context.abrupt(\"return\",config);case 23:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}(),function(error){return Promise.reject(error);});function transormData(data){return data&&!data._id?Object.keys(data).map(function(key){return _objectSpread({},data[key]);}):data;}http.interceptors.response.use(function(res){if(configFile.isFireBase){res.data={content:transormData(res.data)};}res.data={content:res.data};return res;},function(error){var expectedErrors=error.response&&error.response.status>=400&&error.response.status<500;if(!expectedErrors){console.log(error);toast.error(\"Somthing was wrong. Try it later\");}return Promise.reject(error);});var httpService={get:http.get,post:http.post,put:http.put,delete:http.delete,patch:http.patch};export default httpService;","map":{"version":3,"names":["axios","toast","configFile","authService","localStorageService","http","create","baseURL","apiEndpoint","interceptors","request","use","config","expiresDate","getTokenExpiresDate","refreshToken","getRefreshToken","isExpired","Date","now","isFireBase","containSlash","test","url","slice","refresh","data","setTokens","refresh_token","idToken","id_token","expiresIn","expires_in","localId","user_id","accessToken","getAccessToken","params","auth","headers","Authorization","error","Promise","reject","transormData","_id","Object","keys","map","key","response","res","content","expectedErrors","status","console","log","httpService","get","post","put","delete","patch"],"sources":["/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/src/app/services/http.service.js"],"sourcesContent":["import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport configFile from \"../config.json\";\nimport authService from \"./auth.service\";\n\nimport localStorageService from \"./localStorage.service\";\n\nconst http = axios.create({\n  baseURL: configFile.apiEndpoint\n});\n\nhttp.interceptors.request.use(\n  async function (config) {\n    const expiresDate = localStorageService.getTokenExpiresDate();\n    const refreshToken = localStorageService.getRefreshToken();\n    const isExpired = refreshToken && expiresDate < Date.now();\n\n    if (configFile.isFireBase) {\n      const containSlash = /\\/$/gi.test(config.url);\n      config.url =\n        (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n      if (isExpired) {\n        const data = await authService.refresh();\n\n        localStorageService.setTokens({\n          refreshToken: data.refresh_token,\n          idToken: data.id_token,\n          expiresIn: data.expires_in,\n          localId: data.user_id\n        });\n      }\n      const accessToken = localStorageService.getAccessToken();\n      if (accessToken) {\n        config.params = { ...config.params, auth: accessToken };\n      }\n    } else {\n      if (isExpired) {\n        const data = await authService.refresh();\n        localStorageService.setTokens(data);\n      }\n      const accessToken = localStorageService.getAccessToken();\n      if (accessToken) {\n        config.headers = {\n          ...config.headers,\n          Authorization: `Bearer ${accessToken}`\n        };\n      }\n    }\n    return config;\n  },\n  function (error) {\n    return Promise.reject(error);\n  }\n);\n\nfunction transormData(data) {\n  return data && !data._id\n    ? Object.keys(data).map((key) => ({\n      ...data[key]\n    }))\n    : data;\n}\n\nhttp.interceptors.response.use(\n  (res) => {\n    if (configFile.isFireBase) {\n      res.data = { content: transormData(res.data) };\n    }\n    res.data = { content: res.data };\n    return res;\n  },\n  function (error) {\n    const expectedErrors =\n      error.response &&\n      error.response.status >= 400 &&\n      error.response.status < 500;\n\n    if (!expectedErrors) {\n      console.log(error);\n      toast.error(\"Somthing was wrong. Try it later\");\n    }\n    return Promise.reject(error);\n  }\n);\nconst httpService = {\n  get: http.get,\n  post: http.post,\n  put: http.put,\n  delete: http.delete,\n  patch: http.patch\n};\nexport default httpService;\n"],"mappings":"2hBAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAASC,KAAK,KAAQ,gBAAgB,CACtC,MAAOC,WAAU,KAAM,gBAAgB,CACvC,MAAOC,YAAW,KAAM,gBAAgB,CAExC,MAAOC,oBAAmB,KAAM,wBAAwB,CAExD,GAAMC,KAAI,CAAGL,KAAK,CAACM,MAAM,CAAC,CACxBC,OAAO,CAAEL,UAAU,CAACM,WACtB,CAAC,CAAC,CAEFH,IAAI,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,0FAC3B,iBAAgBC,MAAM,0MACdC,WAAW,CAAGT,mBAAmB,CAACU,mBAAmB,EAAE,CACvDC,YAAY,CAAGX,mBAAmB,CAACY,eAAe,EAAE,CACpDC,SAAS,CAAGF,YAAY,EAAIF,WAAW,CAAGK,IAAI,CAACC,GAAG,EAAE,KAEtDjB,UAAU,CAACkB,UAAU,0BACjBC,YAAY,CAAG,OAAO,CAACC,IAAI,CAACV,MAAM,CAACW,GAAG,CAAC,CAC7CX,MAAM,CAACW,GAAG,CACR,CAACF,YAAY,CAAGT,MAAM,CAACW,GAAG,CAACC,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,CAAGZ,MAAM,CAACW,GAAG,EAAI,OAAO,CAAC,IAC9DN,SAAS,gDACQd,YAAW,CAACsB,OAAO,EAAE,QAAlCC,IAAI,eAEVtB,mBAAmB,CAACuB,SAAS,CAAC,CAC5BZ,YAAY,CAAEW,IAAI,CAACE,aAAa,CAChCC,OAAO,CAAEH,IAAI,CAACI,QAAQ,CACtBC,SAAS,CAAEL,IAAI,CAACM,UAAU,CAC1BC,OAAO,CAAEP,IAAI,CAACQ,OAChB,CAAC,CAAC,CAAC,QAECC,WAAW,CAAG/B,mBAAmB,CAACgC,cAAc,EAAE,CACxD,GAAID,WAAW,CAAE,CACfvB,MAAM,CAACyB,MAAM,gCAAQzB,MAAM,CAACyB,MAAM,MAAEC,IAAI,CAAEH,WAAW,EAAE,CACzD,CAAC,mCAEGlB,SAAS,iDACQd,YAAW,CAACsB,OAAO,EAAE,SAAlCC,KAAI,eACVtB,mBAAmB,CAACuB,SAAS,CAACD,KAAI,CAAC,CAAC,QAEhCS,YAAW,CAAG/B,mBAAmB,CAACgC,cAAc,EAAE,CACxD,GAAID,YAAW,CAAE,CACfvB,MAAM,CAAC2B,OAAO,gCACT3B,MAAM,CAAC2B,OAAO,MACjBC,aAAa,kBAAYL,YAAW,CAAE,EACvC,CACH,CAAC,wCAEIvB,MAAM,yDACd,+DACD,SAAU6B,KAAK,CAAE,CACf,MAAOC,QAAO,CAACC,MAAM,CAACF,KAAK,CAAC,CAC9B,CAAC,CACF,CAED,QAASG,aAAY,CAAClB,IAAI,CAAE,CAC1B,MAAOA,KAAI,EAAI,CAACA,IAAI,CAACmB,GAAG,CACpBC,MAAM,CAACC,IAAI,CAACrB,IAAI,CAAC,CAACsB,GAAG,CAAC,SAACC,GAAG,0BACvBvB,IAAI,CAACuB,GAAG,CAAC,GACZ,CAAC,CACDvB,IAAI,CACV,CAEArB,IAAI,CAACI,YAAY,CAACyC,QAAQ,CAACvC,GAAG,CAC5B,SAACwC,GAAG,CAAK,CACP,GAAIjD,UAAU,CAACkB,UAAU,CAAE,CACzB+B,GAAG,CAACzB,IAAI,CAAG,CAAE0B,OAAO,CAAER,YAAY,CAACO,GAAG,CAACzB,IAAI,CAAE,CAAC,CAChD,CACAyB,GAAG,CAACzB,IAAI,CAAG,CAAE0B,OAAO,CAAED,GAAG,CAACzB,IAAK,CAAC,CAChC,MAAOyB,IAAG,CACZ,CAAC,CACD,SAAUV,KAAK,CAAE,CACf,GAAMY,eAAc,CAClBZ,KAAK,CAACS,QAAQ,EACdT,KAAK,CAACS,QAAQ,CAACI,MAAM,EAAI,GAAG,EAC5Bb,KAAK,CAACS,QAAQ,CAACI,MAAM,CAAG,GAAG,CAE7B,GAAI,CAACD,cAAc,CAAE,CACnBE,OAAO,CAACC,GAAG,CAACf,KAAK,CAAC,CAClBxC,KAAK,CAACwC,KAAK,CAAC,kCAAkC,CAAC,CACjD,CACA,MAAOC,QAAO,CAACC,MAAM,CAACF,KAAK,CAAC,CAC9B,CAAC,CACF,CACD,GAAMgB,YAAW,CAAG,CAClBC,GAAG,CAAErD,IAAI,CAACqD,GAAG,CACbC,IAAI,CAAEtD,IAAI,CAACsD,IAAI,CACfC,GAAG,CAAEvD,IAAI,CAACuD,GAAG,CACbC,MAAM,CAAExD,IAAI,CAACwD,MAAM,CACnBC,KAAK,CAAEzD,IAAI,CAACyD,KACd,CAAC,CACD,cAAeL,YAAW"},"metadata":{},"sourceType":"module"}