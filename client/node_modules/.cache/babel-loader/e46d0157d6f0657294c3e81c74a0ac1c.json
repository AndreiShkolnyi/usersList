{"ast":null,"code":"import _defineProperty from\"/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _createForOfIteratorHelper from\"/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _objectSpread from\"/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{validator}from\"../../../utils/validator\";import TextField from\"../../common/form/textField\";import SelectField from\"../../common/form/selectField\";import RadioField from\"../../common/form/radio.Field\";import MultiSelectField from\"../../common/form/multiSelectField\";import BackHistoryButton from\"../../common/backButton\";import{useSelector,useDispatch}from\"react-redux\";import{getQualities,getQualitiesLoadingStatus}from\"../../../store/qualities\";import{getProfessions,getProfessionsLoadingStatus}from\"../../../store/professions\";import{getCurrentUserData,updateUser}from\"../../../store/users\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditUserPage=function EditUserPage(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var currentUser=useSelector(getCurrentUserData());var dispatch=useDispatch();var qualities=useSelector(getQualities());var qualitiesLoading=useSelector(getQualitiesLoadingStatus());var qualitiesList=qualities.map(function(q){return{label:q.name,value:q._id};});var professions=useSelector(getProfessions());var professionLoading=useSelector(getProfessionsLoadingStatus());var professionsList=professions.map(function(p){return{label:p.name,value:p._id};});var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),errors=_useState6[0],setErrors=_useState6[1];var handleSubmit=function handleSubmit(e){e.preventDefault();var isValid=validate();if(!isValid)return;dispatch(updateUser(_objectSpread(_objectSpread({},data),{},{qualities:data.qualities.map(function(q){return q.value;})})));};function getQualitiesListByIds(qualitiesIds){var qualitiesArray=[];var _iterator=_createForOfIteratorHelper(qualitiesIds),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var qualId=_step.value;var _iterator2=_createForOfIteratorHelper(qualities),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var quality=_step2.value;if(quality._id===qualId){qualitiesArray.push(quality);break;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}}catch(err){_iterator.e(err);}finally{_iterator.f();}return qualitiesArray;}var transformData=function transformData(data){var result=getQualitiesListByIds(data).map(function(qual){return{label:qual.name,value:qual._id};});return result;};useEffect(function(){if(!professionLoading&&!qualitiesLoading&&currentUser&&!data){setData(_objectSpread(_objectSpread({},currentUser),{},{qualities:transformData(currentUser.qualities)}));}},[professionLoading,qualitiesLoading,currentUser,data]);useEffect(function(){if(data&&isLoading){setIsLoading(false);}},[data]);var validatorConfog={email:{isRequired:{message:\"Электронная почта обязательна для заполнения\"},isEmail:{message:\"Email введен некорректно\"}},name:{isRequired:{message:\"Введите ваше имя\"}}};useEffect(function(){return validate();},[data]);var handleChange=function handleChange(target){setData(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},target.name,target.value));});};var validate=function validate(){var errors=validator(data,validatorConfog);setErrors(errors);return Object.keys(errors).length===0;};var isValid=Object.keys(errors).length===0;return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-5\",children:[/*#__PURE__*/_jsx(BackHistoryButton,{}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 offset-md-3 shadow p-4\",children:!isLoading&&Object.keys(professions).length>0?/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(TextField,{label:\"\\u0418\\u043C\\u044F\",name:\"name\",value:data.name,onChange:handleChange,error:errors.name}),/*#__PURE__*/_jsx(TextField,{label:\"\\u042D\\u043B\\u0435\\u043A\\u0442\\u0440\\u043E\\u043D\\u043D\\u0430\\u044F \\u043F\\u043E\\u0447\\u0442\\u0430\",name:\"email\",value:data.email,onChange:handleChange,error:errors.email}),/*#__PURE__*/_jsx(SelectField,{label:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438 \\u0441\\u0432\\u043E\\u044E \\u043F\\u0440\\u043E\\u0444\\u0435\\u0441\\u0441\\u0438\\u044E\",defaultOption:\"Choose...\",name:\"profession\",options:professionsList,onChange:handleChange,value:data.profession,error:errors.profession}),/*#__PURE__*/_jsx(RadioField,{options:[{name:\"Male\",value:\"male\"},{name:\"Female\",value:\"female\"},{name:\"Other\",value:\"other\"}],value:data.sex,name:\"sex\",onChange:handleChange,label:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0432\\u0430\\u0448 \\u043F\\u043E\\u043B\"}),/*#__PURE__*/_jsx(MultiSelectField,{defaultValue:data.qualities,options:qualitiesList,onChange:handleChange,name:\"qualities\",label:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0432\\u0430\\u0448\\u0438 \\u043A\\u0430\\u0447\\u0435\\u0441\\u0432\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!isValid,className:\"btn btn-primary w-100 mx-auto\",children:\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C\"})]}):\"Loading...\"})})]});};export default EditUserPage;","map":{"version":3,"names":["React","useEffect","useState","validator","TextField","SelectField","RadioField","MultiSelectField","BackHistoryButton","useSelector","useDispatch","getQualities","getQualitiesLoadingStatus","getProfessions","getProfessionsLoadingStatus","getCurrentUserData","updateUser","EditUserPage","isLoading","setIsLoading","data","setData","currentUser","dispatch","qualities","qualitiesLoading","qualitiesList","map","q","label","name","value","_id","professions","professionLoading","professionsList","p","errors","setErrors","handleSubmit","e","preventDefault","isValid","validate","getQualitiesListByIds","qualitiesIds","qualitiesArray","qualId","quality","push","transformData","result","qual","validatorConfog","email","isRequired","message","isEmail","handleChange","target","prevState","Object","keys","length","profession","sex"],"sources":["/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/src/app/components/page/editUserPage/editUserPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { validator } from \"../../../utils/validator\";\nimport TextField from \"../../common/form/textField\";\nimport SelectField from \"../../common/form/selectField\";\nimport RadioField from \"../../common/form/radio.Field\";\nimport MultiSelectField from \"../../common/form/multiSelectField\";\nimport BackHistoryButton from \"../../common/backButton\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n    getQualities,\n    getQualitiesLoadingStatus\n} from \"../../../store/qualities\";\nimport {\n    getProfessions,\n    getProfessionsLoadingStatus\n} from \"../../../store/professions\";\nimport { getCurrentUserData, updateUser } from \"../../../store/users\";\n\nconst EditUserPage = () => {\n    const [isLoading, setIsLoading] = useState(true);\n    const [data, setData] = useState();\n    const currentUser = useSelector(getCurrentUserData());\n    const dispatch = useDispatch();\n    const qualities = useSelector(getQualities());\n    const qualitiesLoading = useSelector(getQualitiesLoadingStatus());\n    const qualitiesList = qualities.map((q) => ({\n        label: q.name,\n        value: q._id\n    }));\n    const professions = useSelector(getProfessions());\n    const professionLoading = useSelector(getProfessionsLoadingStatus());\n    const professionsList = professions.map((p) => ({\n        label: p.name,\n        value: p._id\n    }));\n\n    const [errors, setErrors] = useState({});\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        const isValid = validate();\n        if (!isValid) return;\n        dispatch(\n            updateUser({\n                ...data,\n                qualities: data.qualities.map((q) => q.value)\n            })\n        );\n    };\n    function getQualitiesListByIds(qualitiesIds) {\n        const qualitiesArray = [];\n        for (const qualId of qualitiesIds) {\n            for (const quality of qualities) {\n                if (quality._id === qualId) {\n                    qualitiesArray.push(quality);\n                    break;\n                }\n            }\n        }\n        return qualitiesArray;\n    }\n    const transformData = (data) => {\n        const result = getQualitiesListByIds(data).map((qual) => ({\n            label: qual.name,\n            value: qual._id\n        }));\n\n        return result;\n    };\n    useEffect(() => {\n        if (!professionLoading && !qualitiesLoading && currentUser && !data) {\n            setData({\n                ...currentUser,\n                qualities: transformData(currentUser.qualities)\n            });\n        }\n    }, [professionLoading, qualitiesLoading, currentUser, data]);\n    useEffect(() => {\n        if (data && isLoading) {\n            setIsLoading(false);\n        }\n    }, [data]);\n\n    const validatorConfog = {\n        email: {\n            isRequired: {\n                message: \"Электронная почта обязательна для заполнения\"\n            },\n            isEmail: {\n                message: \"Email введен некорректно\"\n            }\n        },\n\n        name: {\n            isRequired: {\n                message: \"Введите ваше имя\"\n            }\n        }\n    };\n    useEffect(() => validate(), [data]);\n    const handleChange = (target) => {\n        setData((prevState) => ({\n            ...prevState,\n            [target.name]: target.value\n        }));\n    };\n    const validate = () => {\n        const errors = validator(data, validatorConfog);\n        setErrors(errors);\n        return Object.keys(errors).length === 0;\n    };\n    const isValid = Object.keys(errors).length === 0;\n    return (\n        <div className=\"container mt-5\">\n            <BackHistoryButton />\n            <div className=\"row\">\n                <div className=\"col-md-6 offset-md-3 shadow p-4\">\n                    {!isLoading && Object.keys(professions).length > 0 ? (\n                        <form onSubmit={handleSubmit}>\n                            <TextField\n                                label=\"Имя\"\n                                name=\"name\"\n                                value={data.name}\n                                onChange={handleChange}\n                                error={errors.name}\n                            />\n                            <TextField\n                                label=\"Электронная почта\"\n                                name=\"email\"\n                                value={data.email}\n                                onChange={handleChange}\n                                error={errors.email}\n                            />\n                            <SelectField\n                                label=\"Выбери свою профессию\"\n                                defaultOption=\"Choose...\"\n                                name=\"profession\"\n                                options={professionsList}\n                                onChange={handleChange}\n                                value={data.profession}\n                                error={errors.profession}\n                            />\n                            <RadioField\n                                options={[\n                                    { name: \"Male\", value: \"male\" },\n                                    { name: \"Female\", value: \"female\" },\n                                    { name: \"Other\", value: \"other\" }\n                                ]}\n                                value={data.sex}\n                                name=\"sex\"\n                                onChange={handleChange}\n                                label=\"Выберите ваш пол\"\n                            />\n                            <MultiSelectField\n                                defaultValue={data.qualities}\n                                options={qualitiesList}\n                                onChange={handleChange}\n                                name=\"qualities\"\n                                label=\"Выберите ваши качесвта\"\n                            />\n                            <button\n                                type=\"submit\"\n                                disabled={!isValid}\n                                className=\"btn btn-primary w-100 mx-auto\"\n                            >\n                                Обновить\n                            </button>\n                        </form>\n                    ) : (\n                        \"Loading...\"\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default EditUserPage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}