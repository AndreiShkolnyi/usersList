{"ast":null,"code":"import { createAction, createSlice } from \"@reduxjs/toolkit\";\nimport authService from \"../services/auth.service\";\nimport localStorageService from \"../services/localStorage.service\";\nimport userService from \"../services/user.service\";\nimport history from \"../utils/history\";\nconst initialState = localStorageService.getAccessToken() ? {\n  entities: null,\n  isLoading: true,\n  error: null,\n  auth: {\n    userId: localStorageService.getUserId()\n  },\n  isLoggedIn: true,\n  dataLoaded: false\n} : {\n  entities: null,\n  isLoading: false,\n  error: null,\n  auth: null,\n  isLoggedIn: false,\n  dataLoaded: false\n};\nconst usersSlice = createSlice({\n  name: \"users\",\n  initialState,\n  reducers: {\n    usersRequested: state => {\n      state.isLoading = true;\n    },\n    usersReceved: (state, action) => {\n      state.entities = action.payload;\n      state.dataLoaded = true;\n      state.isLoading = false;\n    },\n    usersRequestFiled: (state, action) => {\n      state.error = action.payload;\n      state.isLoading = false;\n    },\n    authRequestSuccess: (state, action) => {\n      state.auth = action.payload;\n      state.isLoggedIn = true;\n    },\n    authRequestFailed: (state, action) => {\n      state.error = action.payload;\n    },\n    userCreated: (state, action) => {\n      state.entities.push(action.payload);\n    },\n    userLoggedOut: state => {\n      state.entities = null;\n      state.isLoggedIn = false;\n      state.auth = null;\n      state.dataLoaded = false;\n    },\n    userUpdateSuccessed: (state, action) => {\n      state.entities[state.entities.findIndex(u => u._id === action.payload._id)] = action.payload;\n    },\n    authRequested: state => {\n      state.error = null;\n    }\n  }\n});\nconst {\n  reducer: usersReducer,\n  actions\n} = usersSlice;\nconst {\n  usersRequested,\n  usersReceved,\n  // usersRequestFiled,\n  // authRequestFailed,\n  authRequestSuccess,\n  userLoggedOut,\n  userUpdateSuccessed\n} = actions;\nconst authRequested = createAction(\"users/authRequested\");\n// const userUpdateFailed = createAction(\"users/userUpdateFailed\");\nconst userUpdateRequested = createAction(\"users/userUpdateRequested\");\nexport const login = _ref => {\n  let {\n    payload,\n    redirect\n  } = _ref;\n  return async dispatch => {\n    const {\n      email,\n      password\n    } = payload;\n    dispatch(authRequested());\n    try {\n      const data = await authService.login({\n        email,\n        password\n      });\n      localStorageService.setTokens(data);\n      dispatch(authRequestSuccess({\n        userId: data.userId\n      }));\n      history.push(redirect);\n    } catch (error) {\n      // const { code, message } = error.response.data.error;\n      // if (code === 400) {\n      //     const errorMessage = generetaAuthError(message);\n      //     dispatch(authRequestFailed(errorMessage));\n      // } else {\n      //     dispatch(authRequestFailed(error.message));\n      // }\n    }\n  };\n};\nexport const signUp = payload => async dispatch => {\n  dispatch(authRequested());\n  try {\n    const data = await authService.register(payload);\n    localStorageService.setTokens(data);\n    dispatch(authRequestSuccess({\n      userId: data.userId\n    }));\n    history.push(\"/users\");\n  } catch (error) {\n    // dispatch(authRequestFailed(error.message));\n  }\n};\nexport const logOut = () => dispatch => {\n  localStorageService.removeAuthData();\n  dispatch(userLoggedOut());\n  history.push(\"/\");\n};\nexport const loadUsersList = () => async dispatch => {\n  dispatch(usersRequested());\n  try {\n    const {\n      content\n    } = await userService.get();\n    dispatch(usersReceved(content));\n  } catch (error) {\n    // dispatch(usersRequestFiled(error.message));\n  }\n};\nexport const updateUser = payload => async dispatch => {\n  dispatch(userUpdateRequested());\n  try {\n    const {\n      content\n    } = await userService.update(payload);\n    dispatch(userUpdateSuccessed(content));\n    history.push(`/users/${content._id}`);\n  } catch (error) {\n    // dispatch(userUpdateFailed(error));\n  }\n};\nexport const getUsersList = () => state => state.users.entities;\nexport const getCurrentUserData = () => state => {\n  return state.users.entities ? state.users.entities.find(u => u._id === state.users.auth.userId) : null;\n};\nexport const getUserById = userId => state => {\n  if (state.users.entities) {\n    return state.users.entities.find(u => u._id === userId);\n  }\n};\nexport const getIsLoggedIn = () => state => state.users.isLoggedIn;\nexport const getDataStatus = () => state => state.users.dataLoaded;\nexport const getUsersLoadingStatus = () => state => state.users.isLoading;\nexport const getCurrentUserId = () => state => state.users.auth.userId;\nexport const getAuthErrors = () => state => state.users.error;\nexport default usersReducer;","map":{"version":3,"names":["createAction","createSlice","authService","localStorageService","userService","history","initialState","getAccessToken","entities","isLoading","error","auth","userId","getUserId","isLoggedIn","dataLoaded","usersSlice","name","reducers","usersRequested","state","usersReceved","action","payload","usersRequestFiled","authRequestSuccess","authRequestFailed","userCreated","push","userLoggedOut","userUpdateSuccessed","findIndex","u","_id","authRequested","reducer","usersReducer","actions","userUpdateRequested","login","redirect","dispatch","email","password","data","setTokens","signUp","register","logOut","removeAuthData","loadUsersList","content","get","updateUser","update","getUsersList","users","getCurrentUserData","find","getUserById","getIsLoggedIn","getDataStatus","getUsersLoadingStatus","getCurrentUserId","getAuthErrors"],"sources":["/Users/sikollineu-iandeulei/Desktop/Userslist/usersList/client/src/app/store/users.ts"],"sourcesContent":["import { IUser } from \"./../types/types\";\nimport { AppDispatch } from \"./createStore\";\nimport { createAction, createSlice } from \"@reduxjs/toolkit\";\nimport authService from \"../services/auth.service\";\nimport localStorageService from \"../services/localStorage.service\";\nimport userService from \"../services/user.service\";\nimport history from \"../utils/history\";\n\ninterface loginProps {\n    payload: any;\n    redirect: any;\n}\n\ninterface initialProps {\n    entities: null | any;\n    isLoading: boolean;\n    error: null | any;\n    auth: null | any;\n    isLoggedIn: boolean;\n    dataLoaded: boolean;\n}\n\nconst initialState: initialProps = localStorageService.getAccessToken()\n    ? {\n          entities: null,\n          isLoading: true,\n          error: null,\n          auth: { userId: localStorageService.getUserId() },\n          isLoggedIn: true,\n          dataLoaded: false\n      }\n    : {\n          entities: null,\n          isLoading: false,\n          error: null,\n          auth: null,\n          isLoggedIn: false,\n          dataLoaded: false\n      };\n\nconst usersSlice = createSlice({\n    name: \"users\",\n    initialState,\n    reducers: {\n        usersRequested: (state) => {\n            state.isLoading = true;\n        },\n        usersReceved: (state, action) => {\n            state.entities = action.payload;\n            state.dataLoaded = true;\n            state.isLoading = false;\n        },\n        usersRequestFiled: (state, action) => {\n            state.error = action.payload;\n            state.isLoading = false;\n        },\n        authRequestSuccess: (state, action) => {\n            state.auth = action.payload;\n            state.isLoggedIn = true;\n        },\n        authRequestFailed: (state, action) => {\n            state.error = action.payload;\n        },\n        userCreated: (state, action) => {\n            state.entities.push(action.payload);\n        },\n        userLoggedOut: (state) => {\n            state.entities = null;\n            state.isLoggedIn = false;\n            state.auth = null;\n            state.dataLoaded = false;\n        },\n        userUpdateSuccessed: (state, action) => {\n            state.entities[\n                state.entities.findIndex(\n                    (u: { _id: any }) => u._id === action.payload._id\n                )\n            ] = action.payload;\n        },\n        authRequested: (state) => {\n            state.error = null;\n        }\n    }\n});\n\nconst { reducer: usersReducer, actions } = usersSlice;\nconst {\n    usersRequested,\n    usersReceved,\n    // usersRequestFiled,\n    // authRequestFailed,\n    authRequestSuccess,\n    userLoggedOut,\n    userUpdateSuccessed\n} = actions;\n\nconst authRequested = createAction(\"users/authRequested\");\n// const userUpdateFailed = createAction(\"users/userUpdateFailed\");\nconst userUpdateRequested = createAction(\"users/userUpdateRequested\");\n\nexport const login =\n    ({ payload, redirect }: loginProps) =>\n    async (dispatch: AppDispatch) => {\n        const { email, password } = payload;\n        dispatch(authRequested());\n        try {\n            const data = await authService.login({ email, password });\n            localStorageService.setTokens(data);\n            dispatch(authRequestSuccess({ userId: data.userId }));\n            history.push(redirect);\n        } catch (error) {\n            // const { code, message } = error.response.data.error;\n            // if (code === 400) {\n            //     const errorMessage = generetaAuthError(message);\n            //     dispatch(authRequestFailed(errorMessage));\n            // } else {\n            //     dispatch(authRequestFailed(error.message));\n            // }\n        }\n    };\n\nexport const signUp = (payload: any) => async (dispatch: AppDispatch) => {\n    dispatch(authRequested());\n    try {\n        const data = await authService.register(payload);\n        localStorageService.setTokens(data);\n        dispatch(authRequestSuccess({ userId: data.userId }));\n        history.push(\"/users\");\n    } catch (error) {\n        // dispatch(authRequestFailed(error.message));\n    }\n};\nexport const logOut = () => (dispatch: AppDispatch) => {\n    localStorageService.removeAuthData();\n    dispatch(userLoggedOut());\n    history.push(\"/\");\n};\nexport const loadUsersList = () => async (dispatch: AppDispatch) => {\n    dispatch(usersRequested());\n    try {\n        const { content } = await userService.get();\n        dispatch(usersReceved(content));\n    } catch (error) {\n        // dispatch(usersRequestFiled(error.message));\n    }\n};\nexport const updateUser = (payload: any) => async (dispatch: AppDispatch) => {\n    dispatch(userUpdateRequested());\n    try {\n        const { content } = await userService.update(payload);\n        dispatch(userUpdateSuccessed(content));\n        history.push(`/users/${content._id}`);\n    } catch (error) {\n        // dispatch(userUpdateFailed(error));\n    }\n};\n\nexport const getUsersList = () => (state: any) => state.users.entities;\nexport const getCurrentUserData = () => (state: any) => {\n    return state.users.entities\n        ? state.users.entities.find(\n              (u: IUser) => u._id === state.users.auth.userId\n          )\n        : null;\n};\nexport const getUserById = (userId: string) => (state: any) => {\n    if (state.users.entities) {\n        return state.users.entities.find((u: IUser) => u._id === userId);\n    }\n};\n\nexport const getIsLoggedIn = () => (state: { users: { isLoggedIn: any } }) =>\n    state.users.isLoggedIn;\nexport const getDataStatus = () => (state: { users: { dataLoaded: any } }) =>\n    state.users.dataLoaded;\nexport const getUsersLoadingStatus =\n    () => (state: { users: { isLoading: any } }) =>\n        state.users.isLoading;\nexport const getCurrentUserId =\n    () => (state: { users: { auth: { userId: any } } }) =>\n        state.users.auth.userId;\nexport const getAuthErrors = () => (state: { users: { error: any } }) =>\n    state.users.error;\nexport default usersReducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}